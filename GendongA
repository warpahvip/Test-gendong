-- SCRIPT UNTUK DEVICE PENGGENDONG (CARRIER) - Enhanced Version
-- Delta Executor Android - Carry System Professional

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Variabel Global
local isCarrying = false
local carriedPlayer = nil
local nearbyPlayers = {}
local detectionRange = 15
local carryTrack = nil
local isMinimized = false
local updateConnection = nil

-- GUI Setup (Professional)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CarrySystemGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 220, 0, 240)
MainFrame.Position = UDim2.new(0, 10, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.05
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

-- Stroke for better appearance
local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(60, 60, 60)
MainStroke.Thickness = 1
MainStroke.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

-- Title Text
local TitleText = Instance.new("TextLabel")
TitleText.Name = "TitleText"
TitleText.Size = UDim2.new(1, -60, 0, 30)
TitleText.Position = UDim2.new(0, 8, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "üéí CARRIER SYSTEM"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextScaled = true
TitleText.Font = Enum.Font.GothamBold
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
MinimizeButton.Position = UDim2.new(1, -55, 0, 2.5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Text = "‚Äî"
MinimizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeButton.TextScaled = true
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 4)
MinCorner.Parent = MinimizeButton

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -27, 0, 2.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextScaled = true
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseButton

-- Content Frame (untuk minimize)
local ContentFrame = Instance.new("Frame")
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, 0, 1, -30)
ContentFrame.Position = UDim2.new(0, 0, 0, 30)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -16, 0, 25)
StatusLabel.Position = UDim2.new(0, 8, 0, 8)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "üì° Ready to Carry"
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
StatusLabel.TextScaled = true
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = ContentFrame

-- Players ScrollFrame
local PlayersFrame = Instance.new("ScrollingFrame")
PlayersFrame.Name = "PlayersFrame"
PlayersFrame.Size = UDim2.new(1, -16, 0, 140)
PlayersFrame.Position = UDim2.new(0, 8, 0, 40)
PlayersFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
PlayersFrame.BorderSizePixel = 0
PlayersFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayersFrame.ScrollBarThickness = 5
PlayersFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
PlayersFrame.Parent = ContentFrame

local PlayersCorner = Instance.new("UICorner")
PlayersCorner.CornerRadius = UDim.new(0, 8)
PlayersCorner.Parent = PlayersFrame

local PlayersLayout = Instance.new("UIListLayout")
PlayersLayout.SortOrder = Enum.SortOrder.Name
PlayersLayout.Padding = UDim.new(0, 4)
PlayersLayout.Parent = PlayersFrame

-- Release Button
local ReleaseButton = Instance.new("TextButton")
ReleaseButton.Name = "ReleaseButton"
ReleaseButton.Size = UDim2.new(1, -16, 0, 30)
ReleaseButton.Position = UDim2.new(0, 8, 0, 190)
ReleaseButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
ReleaseButton.BorderSizePixel = 0
ReleaseButton.Text = "üîì RELEASE PLAYER"
ReleaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ReleaseButton.TextScaled = true
ReleaseButton.Font = Enum.Font.GothamBold
ReleaseButton.Visible = false
ReleaseButton.Parent = ContentFrame

local ReleaseCorner = Instance.new("UICorner")
ReleaseCorner.CornerRadius = UDim.new(0, 8)
ReleaseCorner.Parent = ReleaseButton

-- Button Effects
local function addButtonEffects(button, hoverColor, normalColor)
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = hoverColor,
            Size = button.Size + UDim2.new(0, 2, 0, 1)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = normalColor,
            Size = button.Size - UDim2.new(0, 2, 0, 1)
        }):Play()
    end)
end

-- Add effects to control buttons
addButtonEffects(MinimizeButton, Color3.fromRGB(255, 213, 27), Color3.fromRGB(255, 193, 7))
addButtonEffects(CloseButton, Color3.fromRGB(240, 73, 89), Color3.fromRGB(220, 53, 69))
addButtonEffects(ReleaseButton, Color3.fromRGB(240, 73, 89), Color3.fromRGB(220, 53, 69))

-- Fungsi untuk membuat tombol player
local function createPlayerButton(player, distance)
    local button = Instance.new("TextButton")
    button.Name = player.Name
    button.Size = UDim2.new(1, -10, 0, 30)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.BorderSizePixel = 0
    button.Text = string.format("üë§ %s (%.0fm)", player.DisplayName or player.Name, distance)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextScaled = true
    button.Font = Enum.Font.Gotham
    button.Parent = PlayersFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
    
    -- Button effects
    addButtonEffects(button, Color3.fromRGB(65, 65, 65), Color3.fromRGB(45, 45, 45))
    
    -- Click event
    button.MouseButton1Click:Connect(function()
        if not isCarrying then
            carryPlayerDirectly(player)
        end
    end)
    
    return button
end

-- Fungsi untuk langsung menggendong player
function carryPlayerDirectly(targetPlayer)
    if isCarrying or not targetPlayer or not targetPlayer.Character then
        print("‚ùå Cannot carry: already carrying or invalid target")
        return
    end
    
    local targetCharacter = targetPlayer.Character
    local targetRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
    local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")
    
    if not targetRootPart or not targetHumanoid then
        print("‚ùå Target player missing essential parts")
        return
    end
    
    -- Check if target is already being carried
    if targetCharacter:GetAttribute("IsBeingCarried") then
        print("‚ùå Player is already being carried")
        return
    end
    
    print("üéí Starting carry process for: " .. targetPlayer.Name)
    
    -- Set carrying state
    isCarrying = true
    carriedPlayer = targetPlayer
    
    -- Update UI immediately
    StatusLabel.Text = "üéí Carrying: " .. (targetPlayer.DisplayName or targetPlayer.Name)
    StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
    ReleaseButton.Visible = true
    
    -- Disable target movement
    targetHumanoid.PlatformStand = true
    targetHumanoid.Sit = false
    
    -- Create attachment point on carrier
    local carrierAttachment = Instance.new("Attachment")
    carrierAttachment.Name = "CarrierAttachment"
    carrierAttachment.Position = Vector3.new(0, 1, -1)
    carrierAttachment.Parent = RootPart
    
    -- Create attachment point on target
    local targetAttachment = Instance.new("Attachment")
    targetAttachment.Name = "TargetAttachment"
    targetAttachment.Position = Vector3.new(0, 0, 0)
    targetAttachment.Parent = targetRootPart
    
    -- Create AlignPosition for smooth positioning
    local alignPosition = Instance.new("AlignPosition")
    alignPosition.Name = "CarryAlign"
    alignPosition.Attachment0 = targetAttachment
    alignPosition.Attachment1 = carrierAttachment
    alignPosition.MaxForce = 4000
    alignPosition.Responsiveness = 200
    alignPosition.RigidityEnabled = true
    alignPosition.Parent = targetRootPart
    
    -- Create AlignOrientation for rotation sync
    local alignOrientation = Instance.new("AlignOrientation")
    alignOrientation.Name = "CarryOrientAlign"
    alignOrientation.Attachment0 = targetAttachment
    alignOrientation.Attachment1 = carrierAttachment
    alignOrientation.MaxTorque = 4000
    alignOrientation.Responsiveness = 200
    alignOrientation.RigidityEnabled = true
    alignOrientation.Parent = targetRootPart
    
    -- Position target at shoulder
    carrierAttachment.CFrame = CFrame.new(0, 1.5, -1.2) * CFrame.Angles(math.rad(-15), 0, 0)
    
    -- Set attributes for communication
    targetCharacter:SetAttribute("IsBeingCarried", true)
    targetCharacter:SetAttribute("CarrierName", LocalPlayer.Name)
    Character:SetAttribute("IsCarryingPlayer", targetPlayer.Name)
    
    -- Play carry animation
    if carryTrack then 
        carryTrack:Stop()
        carryTrack:Destroy()
    end
    
    local carryAnim = Instance.new("Animation")
    carryAnim.AnimationId = "rbxassetid://507766388" -- Carry animation
    carryTrack = Humanoid:LoadAnimation(carryAnim)
    carryTrack:Play()
    carryTrack.Looped = true
    carryTrack.Priority = Enum.AnimationPriority.Action
    
    print("‚úÖ Successfully carrying: " .. targetPlayer.Name)
    
    -- Monitor carried player connection
    spawn(function()
        while isCarrying and carriedPlayer == targetPlayer do
            if not targetCharacter.Parent or not targetRootPart.Parent or not targetPlayer.Parent then
                print("‚ö†Ô∏è Carried player disconnected")
                releasePlayer()
                break
            end
            wait(0.5)
        end
    end)
end

-- Fungsi untuk melepas player
function releasePlayer()
    if not isCarrying or not carriedPlayer then
        return
    end
    
    print("üîì Releasing player: " .. carriedPlayer.Name)
    
    local targetCharacter = carriedPlayer.Character
    if targetCharacter then
        local targetHumanoid = targetCharacter:FindFirstChild("Humanoid")
        local targetRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
        
        -- Re-enable movement
        if targetHumanoid then
            targetHumanoid.PlatformStand = false
            targetHumanoid.Sit = false
        end
        
        -- Remove carry constraints
        if targetRootPart then
            local alignPos = targetRootPart:FindFirstChild("CarryAlign")
            local alignOrient = targetRootPart:FindFirstChild("CarryOrientAlign")
            local targetAttach = targetRootPart:FindFirstChild("TargetAttachment")
            
            if alignPos then alignPos:Destroy() end
            if alignOrient then alignOrient:Destroy() end
            if targetAttach then targetAttach:Destroy() end
        end
        
        -- Remove attributes
        targetCharacter:SetAttribute("IsBeingCarried", nil)
        targetCharacter:SetAttribute("CarrierName", nil)
    end
    
    -- Remove carrier attachment
    local carrierAttach = RootPart:FindFirstChild("CarrierAttachment")
    if carrierAttach then carrierAttach:Destroy() end
    
    -- Remove carrier attribute
    Character:SetAttribute("IsCarryingPlayer", nil)
    
    -- Stop animation
    if carryTrack then
        carryTrack:Stop()
        carryTrack:Destroy()
        carryTrack = nil
    end
    
    -- Reset state
    isCarrying = false
    carriedPlayer = nil
    
    -- Update UI
    StatusLabel.Text = "üì° Ready to Carry"
    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    ReleaseButton.Visible = false
    
    print("‚úÖ Player released successfully")
end

-- Update nearby players
local function updateNearbyPlayers()
    if not Character or not RootPart or isCarrying then
        return
    end
    
    -- Clear existing buttons
    for _, child in pairs(PlayersFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    nearbyPlayers = {}
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            local playerRoot = player.Character:FindFirstChild("HumanoidRootPart")
            if playerRoot then
                local distance = (RootPart.Position - playerRoot.Position).Magnitude
                
                -- Check if player can be carried
                local canBeCarried = not player.Character:GetAttribute("IsBeingCarried")
                
                if distance <= detectionRange and canBeCarried then
                    table.insert(nearbyPlayers, {player = player, distance = distance})
                end
            end
        end
    end
    
    -- Sort by distance
    table.sort(nearbyPlayers, function(a, b)
        return a.distance < b.distance
    end)
    
    -- Create buttons
    for _, data in pairs(nearbyPlayers) do
        createPlayerButton(data.player, data.distance)
    end
    
    -- Update canvas size
    PlayersFrame.CanvasSize = UDim2.new(0, 0, 0, #nearbyPlayers * 34)
    
    -- Update status if no players nearby
    if #nearbyPlayers == 0 then
        StatusLabel.Text = "üîç No players nearby"
        StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    elseif not isCarrying then
        StatusLabel.Text = "üì° Ready to Carry"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    end
end

-- Minimize functionality
local function toggleMinimize()
    isMinimized = not isMinimized
    
    local targetSize = isMinimized and UDim2.new(0, 220, 0, 30) or UDim2.new(0, 220, 0, 240)
    local targetTransparency = isMinimized and 1 or 0
    
    -- Animate frame resize
    TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {
        Size = targetSize
    }):Play()
    
    -- Hide/show content
    TweenService:Create(ContentFrame, TweenInfo.new(0.2), {
        BackgroundTransparency = targetTransparency
    }):Play()
    
    -- Hide content elements
    for _, child in pairs(ContentFrame:GetChildren()) do
        if child:IsA("GuiObject") then
            child.Visible = not isMinimized
        end
    end
    
    -- Update minimize button
    MinimizeButton.Text = isMinimized and "‚ñ°" or "‚Äî"
end

-- Control button events
MinimizeButton.MouseButton1Click:Connect(toggleMinimize)

CloseButton.MouseButton1Click:Connect(function()
    -- Stop any ongoing processes
    if updateConnection then updateConnection:Disconnect() end
    releasePlayer()
    
    -- Fade out and destroy
    TweenService:Create(ScreenGui, TweenInfo.new(0.3), {
        BackgroundTransparency = 1
    }):Play()
    
    for _, obj in pairs(ScreenGui:GetDescendants()) do
        if obj:IsA("GuiObject") then
            TweenService:Create(obj, TweenInfo.new(0.3), {
                BackgroundTransparency = 1,
                TextTransparency = 1
            }):Play()
        end
    end
    
    wait(0.3)
    ScreenGui:Destroy()
    print("üóÇÔ∏è Carrier System closed")
end)

-- Release button event
ReleaseButton.MouseButton1Click:Connect(function()
    releasePlayer()
end)

-- Make frame draggable
local dragging = false
local dragStart = nil
local startPos = nil

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

TitleBar.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Main update loop
updateConnection = RunService.Heartbeat:Connect(function()
    if not isMinimized and not isCarrying then
        updateNearbyPlayers()
    end
end)

-- Character respawn handler
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
    releasePlayer()
end)

-- Player leaving handler
Players.PlayerRemoving:Connect(function(player)
    if carriedPlayer == player then
        releasePlayer()
    end
end)

-- Cleanup on character removing
LocalPlayer.CharacterRemoving:Connect(function()
    releasePlayer()
end)

print("‚úÖ Enhanced Carry System (CARRIER) loaded!")
print("üí° Professional UI with minimize/close controls")
print("üéí Click player names to carry them instantly")
