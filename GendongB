-- SCRIPT UNTUK DEVICE YANG DIGENDONG (CARRIED)
-- Delta Executor Android - Carry System (Minimalis)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Variabel Global
local isBeingCarried = false
local carrierPlayer = nil
local nearbyCarriers = {}
local detectionRange = 12
local carryTrack = nil

-- GUI Setup (Minimalis)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CarriedSystemGUI"
ScreenGui.Parent = PlayerGui

-- Main Frame (Lebih kecil)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 180)
MainFrame.Position = UDim2.new(1, -210, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 8)
Corner.Parent = MainFrame

-- Title (Lebih compact)
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 25)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.BorderSizePixel = 0
Title.Text = "ü§ù REQUEST"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = Title

-- Status (Lebih kecil)
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -10, 0, 20)
StatusLabel.Position = UDim2.new(0, 5, 0, 30)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "üîç Mencari..."
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 255)
StatusLabel.TextScaled = true
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = MainFrame

-- Carriers ScrollFrame (Lebih compact)
local CarriersFrame = Instance.new("ScrollingFrame")
CarriersFrame.Name = "CarriersFrame"
CarriersFrame.Size = UDim2.new(1, -10, 0, 100)
CarriersFrame.Position = UDim2.new(0, 5, 0, 55)
CarriersFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
CarriersFrame.BorderSizePixel = 0
CarriersFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
CarriersFrame.ScrollBarThickness = 4
CarriersFrame.BackgroundTransparency = 0.2
CarriersFrame.Parent = MainFrame

local CarriersCorner = Instance.new("UICorner")
CarriersCorner.CornerRadius = UDim.new(0, 6)
CarriersCorner.Parent = CarriersFrame

local CarriersLayout = Instance.new("UIListLayout")
CarriersLayout.SortOrder = Enum.SortOrder.Name
CarriersLayout.Padding = UDim.new(0, 3)
CarriersLayout.Parent = CarriersFrame

-- Release Button (Lebih kecil)
local ReleaseButton = Instance.new("TextButton")
ReleaseButton.Name = "ReleaseButton"
ReleaseButton.Size = UDim2.new(1, -10, 0, 25)
ReleaseButton.Position = UDim2.new(0, 5, 0, 160)
ReleaseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
ReleaseButton.BorderSizePixel = 0
ReleaseButton.Text = "üîì TURUN"
ReleaseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ReleaseButton.TextScaled = true
ReleaseButton.Font = Enum.Font.GothamBold
ReleaseButton.Visible = false
ReleaseButton.Parent = MainFrame

local ReleaseCorner = Instance.new("UICorner")
ReleaseCorner.CornerRadius = UDim.new(0, 6)
ReleaseCorner.Parent = ReleaseButton

-- Fungsi untuk membuat tombol carrier
local function createCarrierButton(player, distance)
    local button = Instance.new("TextButton")
    button.Name = player.Name
    button.Size = UDim2.new(1, -5, 0, 25)
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.BorderSizePixel = 0
    button.Text = string.format("%s (%.0fm)", player.DisplayName or player.Name, distance)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextScaled = true
    button.Font = Enum.Font.Gotham
    button.Parent = CarriersFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 4)
    buttonCorner.Parent = button
    
    -- Hover effect
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(40, 40, 40)}):Play()
    end)
    
    -- Click event - Langsung gendong
    button.MouseButton1Click:Connect(function()
        if not isBeingCarried then
            requestAndAttach(player)
        end
    end)
    
    return button
end

-- Fungsi untuk request dan langsung attach
function requestAndAttach(carrierPlayer)
    if isBeingCarried or not carrierPlayer or not carrierPlayer.Character then
        return
    end
    
    local carrierCharacter = carrierPlayer.Character
    local carrierRootPart = carrierCharacter:FindFirstChild("HumanoidRootPart")
    
    if not carrierRootPart then
        return
    end
    
    -- Set flag carry
    isBeingCarried = true
    carrierPlayer = carrierPlayer
    
    -- Update UI
    StatusLabel.Text = "ü§ù Oleh: " .. (carrierPlayer.DisplayName or carrierPlayer.Name)
    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    ReleaseButton.Visible = true
    
    -- Hide carriers list
    CarriersFrame.Visible = false
    
    -- Disable movement
    Humanoid.PlatformStand = true
    
    -- Create WeldConstraint for instant attachment
    local weld = Instance.new("WeldConstraint")
    weld.Name = "CarryWeld"
    weld.Part0 = RootPart
    weld.Part1 = carrierRootPart
    weld.Parent = RootPart
    
    -- Position di pundak
    local offset = CFrame.new(0, 2, -1.2) * CFrame.Angles(math.rad(-10), 0, 0)
    RootPart.CFrame = carrierRootPart.CFrame * offset
    
    -- Set attributes untuk komunikasi
    Character:SetAttribute("IsBeingCarried", true)
    Character:SetAttribute("CarrierName", carrierPlayer.Name)
    
    -- Animation
    if carryTrack then carryTrack:Stop() end
    local carriedAnim = Instance.new("Animation")
    carriedAnim.AnimationId = "rbxassetid://507777826"
    carryTrack = Humanoid:LoadAnimation(carriedAnim)
    carryTrack:Play()
    carryTrack.Looped = true
    
    -- Monitor connection
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not carrierCharacter.Parent or not carrierRootPart.Parent then
            releaseFromCarrier()
            connection:Disconnect()
        end
    end)
end

-- Fungsi untuk release dari carrier
function releaseFromCarrier()
    if not isBeingCarried then
        return
    end
    
    -- Re-enable controls
    Humanoid.PlatformStand = false
    
    -- Remove weld
    local weld = RootPart:FindFirstChild("CarryWeld")
    if weld then
        weld:Destroy()
    end
    
    -- Stop animation
    if carryTrack then
        carryTrack:Stop()
        carryTrack = nil
    end
    
    -- Reset state
    isBeingCarried = false
    carrierPlayer = nil
    
    -- Update UI
    StatusLabel.Text = "üîç Mencari..."
    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 255)
    ReleaseButton.Visible = false
    CarriersFrame.Visible = true
    
    -- Remove attributes
    Character:SetAttribute("IsBeingCarried", nil)
    Character:SetAttribute("CarrierName", nil)
end

-- Release button event
ReleaseButton.MouseButton1Click:Connect(function()
    releaseFromCarrier()
end)

-- Update nearby carriers
local function updateNearbyCarriers()
    if not Character or not RootPart or isBeingCarried then
        return
    end
    
    -- Clear existing buttons
    for _, child in pairs(CarriersFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    nearbyCarriers = {}
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (RootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
            
            -- Check if player can carry
            local canCarry = true
            for _, otherPlayer in pairs(Players:GetPlayers()) do
                if otherPlayer.Character and otherPlayer.Character:GetAttribute("CarrierName") == player.Name then
                    canCarry = false
                    break
                end
            end
            
            if distance <= detectionRange and canCarry then
                table.insert(nearbyCarriers, {player = player, distance = distance})
            end
        end
    end
    
    -- Sort by distance
    table.sort(nearbyCarriers, function(a, b)
        return a.distance < b.distance
    end)
    
    -- Create buttons
    for _, data in pairs(nearbyCarriers) do
        createCarrierButton(data.player, data.distance)
    end
    
    -- Update canvas size
    CarriersFrame.CanvasSize = UDim2.new(0, 0, 0, #nearbyCarriers * 28)
end

-- Main update loop
RunService.Heartbeat:Connect(function()
    if not isBeingCarried then
        updateNearbyCarriers()
    end
end)

-- Character respawn handler
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    Humanoid = Character:WaitForChild("Humanoid")
    RootPart = Character:WaitForChild("HumanoidRootPart")
    releaseFromCarrier()
end)

-- Player leaving handler
Players.PlayerRemoving:Connect(function(player)
    if carrierPlayer == player then
        releaseFromCarrier()
    end
end)

print("‚úÖ Carry System (CARRIED) - Minimalis loaded!")
print("üí° Klik nama player untuk request digendong")
